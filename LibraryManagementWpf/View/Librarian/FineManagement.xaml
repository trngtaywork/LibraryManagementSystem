<UserControl x:Class="LibraryManagementWpf.View.Librarian.FineManagement"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LibraryManagementWpf.View.Librarian"
        xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
        mc:Ignorable="d"
        d:DesignHeight="720" d:DesignWidth="1080"
        DataContext="{StaticResource LibrarianVM}">

    <UserControl.Resources>
        <ResourceDictionary>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <local:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter"/>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Theme/DefaultTemplate.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Border Background="#eff2f7">
        <Grid>
            <!-- Main Section (Right section of the original window) -->
            <Grid Margin="30 20 20 20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="*"></RowDefinition>
                    <RowDefinition Height="auto"></RowDefinition>
                </Grid.RowDefinitions>

                <!-- Search TextBox -->
                <Grid Width="400" HorizontalAlignment="Left">
                    <Grid Margin="40,28,0,0" Width="300" HorizontalAlignment="Left">
                        <TextBox x:Name="txtSearch" Style="{StaticResource textboxSearch}" Margin="0,0,30,0" TextChanged="txtSearch_TextChanged"/>
                        <TextBlock Panel.ZIndex="1" Text="Search here ..." Visibility="{Binding ElementName=txtSearch, Converter={StaticResource BoolToVis}}" 
                                   Margin="20,0,0,0" VerticalAlignment="Center" Foreground="#b0b9c6" IsHitTestVisible="False"/>
                        <Icon:PackIconMaterial Kind="Magnify" Width="15" Height="15" VerticalAlignment="Center" 
                                               Margin="0,0,45,0" Foreground="#b0b9c6" HorizontalAlignment="Right"/>
                    </Grid>
                </Grid>

                <!-- Top Buttons -->
                <TextBlock Text="Fine Management" Grid.Row="1" FontSize="32" FontWeight="SemiBold" Margin="0 20 0 0"
                           HorizontalAlignment="Left" Foreground="#121518"/>

                <Separator Height="1" Grid.Row="2" Background="#dae2ea" Margin="0 1 0 10"/>

                <!-- Counter Title -->
                <TextBlock x:Name="txtNumberOfFines" Grid.Row="3" FontSize="18" FontWeight="SemiBold" Foreground="#121578" HorizontalAlignment="Left" VerticalAlignment="Center">
                </TextBlock>

                <TextBlock Text="Sort by" Grid.Row="3" FontSize="13" Margin="0 0 215 0" FontWeight="SemiBold" Foreground="#121578" HorizontalAlignment="Right" VerticalAlignment="Center">
                </TextBlock>

                <!-- ComboBox Sort -->
                <ComboBox Grid.Row="3" Name="cbSortOptions" Width="200" HorizontalAlignment="Right" Margin="0 5 0 5" SelectionChanged="cbSortOptions_SelectionChanged" Style="{StaticResource ComboBoxFlatStyle}">
                    <ComboBoxItem Content="Highest Fine" />
                    <ComboBoxItem Content="Lowest Fine" />
                    <ComboBoxItem Content="By Borrower Name" />
                    <ComboBoxItem Content="By Fine ID" />
                </ComboBox>

                <!-- ListView for Fines -->
                <DataGrid Name="lvFine" Grid.Row="4" HorizontalAlignment="Stretch" VerticalAlignment="Top" Height="450" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
                    <DataGrid.Resources>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding StatusOfFine}" Value="Paid">
                                    <Setter Property="Background" Value="LightGreen"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding StatusOfFine}" Value="Unpaid">
                                    <Setter Property="Background" Value="LightCoral"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTextColumn Width="*" Header="Fine ID" Binding="{Binding FineId}" />
                        <DataGridTextColumn Width="*" Header="Borrower Name" Binding="{Binding BorrowerName}" />
                        <DataGridTextColumn Width="*" Header="Fine Type" Binding="{Binding FineType}" />
                        <DataGridTextColumn Width="*" Header="Fine Amount" Binding="{Binding FineAmount}" />
                        <DataGridTextColumn Width="*" Header="Status Of Fine" Binding="{Binding StatusOfFine}" />
                        <DataGridTextColumn Width="*" Header="Paid Date" Binding="{Binding PaidDate}" />
                        <DataGridTemplateColumn Header="Actions">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Name="btnPay" Content="Pay" Click="btnPay_Click" Width="50"
                                            Visibility="{Binding StatusOfFine, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter='Unpaid'}" 
                                            CommandParameter="{Binding}"/>  
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                 <!-- Pagination Controls -->
                 <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
                     <Button x:Name="btnPrevious" Content="Previous" Click="PreviousPage_Click" />
                     <TextBlock x:Name="lblPageInfo" Text="Page 1 of 1" Margin="10 0" VerticalAlignment="Center" />
                     <Button x:Name="btnNext" Content="Next" Click="NextPage_Click" />
                 </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
